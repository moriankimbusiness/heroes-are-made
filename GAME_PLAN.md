# GAME PLAN (업데이트: 2026-02-25)

# 플레이영역

* 화면 중간에 위치한다.
* 다이아몬드 모양이다.
* 히어로는 플레이영역을 벗어날 수 없다.

---

# 히어로

## 이동 및 범위

* 드래그 앤 드랍으로 플레이영역 안에서 자유롭게 이동한다.
* 드래그 중 실시간 충돌 체크로 즉시 위치가 보정된다.

## 생성

* 하단의 `모험가 뽑기` 버튼으로 플레이영역 중앙에 생성된다.

## 상태창

* `히어로를 클릭했을 때만` 상태창이 열린다.
* 상태창은 선택 히어로의 우측에 표시된다.
* 히어로를 드래그로 이동하면 상태창도 함께 따라간다.
* 상태창/인벤토리/UI 바깥 월드를 클릭하면 열려 있는 상태창(히어로/Enemy)이 닫힌다.
* 히어로 상태창 기준점은 `hero_base`의 `StatusAnchor`로 관리한다.
* 상태창 우측 위치 튜닝은 `hero_base`에서 `StatusAnchor` 위치를 에디터로 조정한다.

---

### 스텟창 (상태창 왼쪽)

* 스텟: 힘/민첩/지능
* 힘: 물리공격력에 반영
* 민첩: 공격속도(APS)에 반영
* 지능: 마법공격력에 반영
* 스텟값은 양수/음수 모두 가능
* 음수 스텟은 UI에서 경고색으로 표시

#### 공격속도 규칙

* 공식: `APS = base_aps * (1 + agi * k)`
* 최소 APS 클램프: `0.1`
* 밸런스 표: `docs/balance/attack_speed_table.md`

---

### 장비창 (상태창 오른쪽)

* 슬롯: 머리, 왼손, 몸, 오른손, 발 (5개)
* 장비 착용 시 아이템 스텟이 히어로 스텟/전투값에 즉시 반영

#### 장비 아이템 상호작용

* Hover: 흰색 윤곽선 + 상세 내용 표시
* 클릭: 공용 인벤토리 빈칸으로 해제
* 드래그 앤 드랍: 인벤토리 슬롯으로 이동 가능

---

# 인벤토리 (공용)

* 히어로별 인벤토리가 아닌 `전체 공용 인벤토리` 1개
* 화면 중앙 아래 위치
* 가로 9칸

## 아이템 종류

* 무기
* 투구
* 갑옷
* 방패
* 신발
* 티어: `common`, `uncommon`, `rare`, `epic`, `legendary`
* 아이템 데이터 원본은 `assets/data/items/item_table.json` 단일 소스를 사용한다.
* 게임 시작 시 `ItemDatabase`(Autoload)가 JSON을 1회 로드하고 런타임 `ItemData`로 캐시한다.
* JSON 스키마 오류/파싱 실패 시 즉시 종료(fail-fast)한다.

## 인벤토리 상호작용

* Hover: 흰색 윤곽선 + 상세 내용 표시
* Hover 툴팁은 최종 반영 수치를 기본 표시하고, `기본값 x 강화배율` 분해 정보를 함께 표시한다.
* 클릭: 선택된 히어로의 올바른 장비 슬롯으로 자동 장착
* 드래그 앤 드랍:
  * 인벤토리 -> 장비창: 장착
  * 인벤토리 -> 인벤토리: 슬롯 이동/스왑

---

## 조합

* 인벤토리에서 같은 아이템 위로 드래그 시 조합 가능 (윤곽선 초록)
* 다른 아이템 위로 드래그 시 조합 불가 (윤곽선 빨강)
* 단, 조합은 같은 강화 레벨끼리만 가능하다.
* 조합 규칙 예시: `+0 + +0 -> +1`, `+1 + +1 -> +2`
* 인벤토리 슬롯 우클릭 시 같은 강화 레벨의 동일 아이템을 공용 인벤토리에서 자동 탐색해 1회 조합한다.

---

# 장비 뽑기

* 하단 중앙 버튼 영역에 `장비 뽑기` 버튼이 `모험가 뽑기` 옆에 배치된다.
* `장비 뽑기` 클릭 시 `ItemDatabase.pool` 가중치 테이블에서 장비 1개를 랜덤 획득한다.
* 획득 아이템은 공용 인벤토리의 첫 빈칸에 지급된다.
* 인벤토리가 가득 찬 경우 클릭은 허용되며, 아이템 지급 없이 경고 안내 라벨만 표시된다.
* 획득/실패 안내 라벨은 이벤트 기반 타이머로 자동 숨김된다(`_process` 미사용).

---

# 아이템 강화

* 동일 아이템 1개를 동일 아이템 위로 드래그 앤 드랍 시 강화(+1)
* 강화 시 원본 1개는 소모되고 대상 아이템 강화 수치가 증가
* 강화 상한은 `+15`이며 `+15` 아이템은 더 이상 합성되지 않는다.
* 강화 배율 테이블: `docs/balance/enhance_table.md`
* 강화 배율은 `공격계수(enh_atk)`와 `기본스탯계수(enh_stat)`를 분리 사용한다.
* 강화 결과는 스텟/공격력에 즉시 반영

---

# Enemy

## 상태창

* `Enemy를 클릭했을 때만` Enemy 상태창이 열린다.
* Enemy 상태창은 선택된 Enemy 우측에 표시된다.
* Enemy가 이동하면 상태창도 함께 따라간다.
* 표시 정보는 `체력: 현재체력 / 최대체력`이다.
* 체력 표시는 정수로 표기한다.
* 선택 상태는 히어로/Enemy 중 하나만 유지된다.
* Enemy 상태창 기준점은 `enemy_base`의 `StatusAnchor`로 관리한다.
* 상태창 우측 위치 튜닝은 `enemy_base`에서 `StatusAnchor` 위치를 에디터로 조정한다.

---

# Enemy 라운드 체력 설계

## 역할 분리

* `enemy_base`는 적 타입 기준 체력(`base_max_health`)을 가진다.
* `level`은 레벨별 난이도 스케일(`level_hp_scale`)을 가진다.
* `round`는 라운드 체력 배율(`round_enemy_health_multipliers`)을 가진다.

## 최종 체력 공식

* `final_hp = enemy_base_max_health * level_hp_scale * round_multiplier`

## 레벨별 적용 기준

* Level 1: `level_hp_scale = 1.0`
* Level 2: `level_hp_scale = 2.0`
* 라운드 배율은 Level 1/2 모두 공통 `1~30` 테이블을 사용한다.

## 30라운드 이후

* `use_formula_after_table = true`로 자동 확장한다.
* 상세값은 `docs/balance/enemy_health_round_table.md` 기준으로 관리한다.
